<ion-header [translucent]="true" class="ion-no-border">
  <ion-toolbar class="header-gradient">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/app/home" color="light"></ion-back-button>
    </ion-buttons>
    <ion-title>Baca Berita</ion-title>
    <ion-buttons slot="end">
      <ion-button *ngIf="user?.id && news?.user_id && user.id == news.user_id" (click)="confirmDelete()" color="light">
        <ion-icon name="trash-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding-bottom">
  
  <div class="wrapper">
  <button (click)="scrollLeft()">‹</button>

  <div class="image-scroller" #scroller>
    <img [src]="news.thumbnail_url ? imgUrl + news.thumbnail_url : 'assets/no-img.jpg'" />
    <img *ngFor="let img of images" [src]="imgUrl + img" />
  </div>

  <button (click)="scrollRight()">›</button>
</div>


  <div class="content-wrapper ion-padding">
    
    <h1 class="news-title">{{ news.title }}</h1>
    
    <div class="meta-row">
      <span class="author">
        <ion-icon name="person-circle-outline"></ion-icon> {{ news.author_name }}
      </span>
      <span class="date">{{ news.created_at | date:'d MMM y • HH:mm' }}</span>
    </div>

    <div class="stats-box">
      <div class="stat-pill">
        <ion-icon name="eye-outline"></ion-icon> {{ news.view_count }}
      </div>
      <div class="stat-pill">
        <ion-icon name="star" color="warning"></ion-icon> {{ news.avg_rating || 0 | number:'1.1-1' }}
      </div>
    </div>

    <div class="news-desc">
      {{ news.description }}
    </div>

    <hr class="divider">

    <ion-button expand="block" (click)="toggleFavorite()" 
      [color]="isFavorite ? 'danger' : 'medium'" 
      [fill]="isFavorite ? 'solid' : 'outline'"
      class="fav-btn">
      <ion-icon [name]="isFavorite ? 'heart' : 'heart-outline'" slot="start"></ion-icon>
      {{ isFavorite ? 'Disimpan di Favorit' : 'Simpan ke Favorit' }}
    </ion-button>

    <div class="rating-section ion-text-center ion-margin-top">
      <p class="section-label">Beri Rating Berita Ini</p>
      <div class="stars-wrapper">
        <ion-icon *ngFor="let i of [1,2,3,4,5]" 
          [name]="i <= userRating ? 'star' : 'star-outline'" 
          [class.active]="i <= userRating"
          (click)="rate(i)">
        </ion-icon>
      </div>
    </div>
  </div>

  <div class="comments-section">
    <div class="section-header ion-padding-horizontal">
      <h3>Komentar <span class="badge">{{ comments.length }}</span></h3>
    </div>

    <div *ngIf="comments.length === 0" class="no-comments ion-text-center">
      <p>Belum ada komentar. Jadilah yang pertama!</p>
    </div>

    <div *ngFor="let c of comments" class="comment-wrap ion-padding-horizontal">
      <div class="comment-box">
        <div class="comment-header">
          <b>{{ c.fullname }}</b> <small>{{ c.created_at | date:'shortTime' }}</small>
        </div>
        <p>{{ c.content }}</p>
        <div class="action-row">
          <span class="reply-trigger" (click)="setReply(c)">Balas</span>
        </div>
      </div>

      <div *ngFor="let r of c.replies" class="reply-box">
        <div class="comment-header">
          <b>{{ r.fullname }}</b> <small>{{ r.created_at | date:'shortTime' }}</small>
        </div>
        <p>{{ r.content }}</p>
      </div>
    </div>
  </div>

</ion-content>

<ion-footer class="ion-no-border">
  <ion-toolbar class="comment-toolbar">
    
    <div *ngIf="replyTo" class="reply-info">
      <span>Membalas: <b>{{ replyTo.fullname }}</b></span>
      <ion-icon name="close-circle" (click)="cancelReply()" color="medium"></ion-icon>
    </div>

    <div class="input-row">
      <ion-input 
        [(ngModel)]="newComment" 
        placeholder="Tulis komentar..."
        class="comment-input"
        (keyup.enter)="sendComment()">
      </ion-input>
      
      <ion-button (click)="sendComment()" fill="clear" color="primary">
        <ion-icon name="send"></ion-icon>
      </ion-button>
    </div>

  </ion-toolbar>
</ion-footer>